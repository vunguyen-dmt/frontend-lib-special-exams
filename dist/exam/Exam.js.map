{"version":3,"file":"Exam.js","names":["_react","_interopRequireWildcard","require","_propTypes","_interopRequireDefault","_i18n","_paragon","_icons","_timer","_instructions","_context","_ExamAPIError","_constants","_messages","_jsxRuntime","obj","__esModule","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","n","toString","slice","constructor","name","Array","from","test","len","length","arr2","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","next","done","push","value","err","isArray","Exam","_ref","isGated","isTimeLimited","originalUserIsStaff","canAccessProctoredExams","children","intl","state","useContext","ExamStateContext","isLoading","activeAttempt","showTimer","stopExam","exam","expireExam","pollAttempt","apiErrorMsg","pingAttempt","getProctoringSettings","submitExam","_ref2","attempt","examType","type","examId","id","passedDueDate","passed_due_date","hideAfterDue","hide_after_due","_ref3","attemptStatus","attempt_status","shouldShowMasqueradeAlert","ExamType","TIMED","ExamStatus","STARTED","_useState","useState","_useState2","hasProctoredExamAccess","setHasProctoredExamAccess","proctoredExamTypes","ONBOARDING","PRACTICE","PROCTORED","useEffect","includes","jsx","className","Spinner","animation","variant","formatMessage","messages","proctoredExamAccessDenied","sequenceContent","Fragment","jsxs","Alert","icon","Info","FormattedMessage","defaultMessage","ExamTimerBlock","stopExamAttempt","expireExamAttempt","pollExamAttempt","propTypes","PropTypes","bool","isRequired","element","intlShape","defaultProps","_default","injectIntl","exports"],"sources":["../../src/exam/Exam.jsx"],"sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useContext, useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { injectIntl, intlShape, FormattedMessage } from '@edx/frontend-platform/i18n';\nimport { Alert, Spinner } from '@edx/paragon';\nimport { Info } from '@edx/paragon/icons';\nimport { ExamTimerBlock } from '../timer';\nimport Instructions from '../instructions';\nimport ExamStateContext from '../context';\nimport ExamAPIError from './ExamAPIError';\nimport { ExamStatus, ExamType } from '../constants';\nimport messages from './messages';\n\n/**\n * Exam component is intended to render exam instructions before and after exam.\n * It is also responsible for rendering exam timer block/component during the exam.\n * If children do not relate to exam sequence, render them directly.\n * @param isTimeLimited - boolean used to identify if we need to process sequence as an exam\n * @param children - sequence content\n * @returns {JSX.Element}\n * @constructor\n */\nconst Exam = ({\n  isGated, isTimeLimited, originalUserIsStaff, canAccessProctoredExams, children, intl,\n}) => {\n  const state = useContext(ExamStateContext);\n  const {\n    isLoading, activeAttempt, showTimer, stopExam, exam,\n    expireExam, pollAttempt, apiErrorMsg, pingAttempt,\n    getProctoringSettings, submitExam,\n  } = state;\n\n  const {\n    attempt,\n    type: examType,\n    id: examId,\n    passed_due_date: passedDueDate,\n    hide_after_due: hideAfterDue,\n  } = exam || {};\n  const { attempt_status: attemptStatus } = attempt || {};\n\n  const shouldShowMasqueradeAlert = () => {\n    // if course staff is masquerading as a specific learner, they should be able\n    // to view the exam content regardless of the learner's current state\n    if (originalUserIsStaff && isTimeLimited) {\n      if (examType === ExamType.TIMED && passedDueDate && !hideAfterDue) {\n        // if the learner is able to view exam content after the due date is passed,\n        // don't show this alert\n        return false;\n      }\n      return attemptStatus !== ExamStatus.STARTED;\n    }\n    return false;\n  };\n\n  const [hasProctoredExamAccess, setHasProctoredExamAccess] = useState(true);\n\n  const proctoredExamTypes = [ExamType.ONBOARDING, ExamType.PRACTICE, ExamType.PROCTORED];\n\n  useEffect(() => {\n    if (proctoredExamTypes.includes(examType)) {\n      // only fetch proctoring settings for a proctored exam\n      if (examId) {\n        getProctoringSettings();\n      }\n\n      // Only exclude Timed Exam when restricting access to exams\n      setHasProctoredExamAccess(canAccessProctoredExams);\n    }\n    // this makes sure useEffect gets called only one time after the exam has been fetched\n    // we can't leave this empty since initially exam is just an empty object, so\n    // API calls above would not get triggered\n  }, [examId]);\n\n  if (isLoading) {\n    return (\n      <div data-testid=\"spinner\" className=\"d-flex justify-content-center align-items-center flex-column my-5 py-5\">\n        <Spinner animation=\"border\" variant=\"primary\" />\n      </div>\n    );\n  }\n\n  if (!hasProctoredExamAccess) {\n    // If the user cannot acces proctoring exam, and the current exam is a proctoring exam,\n    // we want to display a message box to let learner know they have no access.\n    return (\n      <div data-testid=\"no-access\" className=\"d-flex justify-content-center align-items-center flex-column\">\n        {intl.formatMessage(messages.proctoredExamAccessDenied)}\n      </div>\n    );\n  }\n\n  // eslint-disable-next-line react/jsx-no-useless-fragment\n  const sequenceContent = <>{children}</>;\n\n  return (\n    <div className=\"d-flex flex-column justify-content-center\">\n      {shouldShowMasqueradeAlert() && (\n        <Alert variant=\"info\" icon={Info} data-testid=\"masquerade-alert\">\n          <FormattedMessage\n            id=\"exam.hiddenContent\"\n            defaultMessage=\"This exam is hidden from the learner.\"\n          />\n        </Alert>\n      )}\n      {showTimer && (\n        <ExamTimerBlock\n          attempt={activeAttempt}\n          stopExamAttempt={stopExam}\n          submitExam={submitExam}\n          expireExamAttempt={expireExam}\n          pollExamAttempt={pollAttempt}\n          pingAttempt={pingAttempt}\n        />\n      )}\n      { // show the error message only if you are in the exam sequence\n        isTimeLimited && apiErrorMsg && <ExamAPIError />\n      }\n      {isTimeLimited && !originalUserIsStaff && !isGated\n        ? <Instructions>{sequenceContent}</Instructions>\n        : sequenceContent}\n    </div>\n  );\n};\n\nExam.propTypes = {\n  isTimeLimited: PropTypes.bool.isRequired,\n  isGated: PropTypes.bool.isRequired,\n  originalUserIsStaff: PropTypes.bool.isRequired,\n  canAccessProctoredExams: PropTypes.bool,\n  children: PropTypes.element.isRequired,\n  intl: intlShape.isRequired,\n};\n\nExam.defaultProps = {\n  canAccessProctoredExams: true,\n};\n\nexport default injectIntl(Exam);\n"],"mappings":"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"}