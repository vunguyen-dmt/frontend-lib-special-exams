{"version":3,"file":"handlers.js","names":["_constants","_interopRequireDefault","require","obj","__esModule","createWorker","url","blob","Blob","concat","type","blobUrl","window","URL","createObjectURL","Worker","workerTimeoutPromise","timeoutMilliseconds","message","Promise","resolve","reject","setTimeout","Error","workerPromiseForEventNames","eventNames","workerUrl","timeout","attemptExternalId","proctoringBackendWorker","responseHandler","e","data","successEventName","removeEventListener","terminate","error","addEventListener","postMessage","promptEventName","pingApplication","timeoutInSeconds","TIMEOUT_BUFFER_SECONDS","workerPingTimeout","race","actionToMessageTypesMap","ping"],"sources":["../../../src/data/messages/handlers.js"],"sourcesContent":["import actionToMessageTypesMap from './constants';\n\nfunction createWorker(url) {\n  const blob = new Blob([`importScripts('${url}');`], { type: 'application/javascript' });\n  const blobUrl = window.URL.createObjectURL(blob);\n  return new Worker(blobUrl);\n}\n\nfunction workerTimeoutPromise(timeoutMilliseconds) {\n  const message = `worker failed to respond after ${timeoutMilliseconds} ms`;\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      reject(Error(message));\n    }, timeoutMilliseconds);\n  });\n}\n\nexport function workerPromiseForEventNames(eventNames, workerUrl) {\n  return (timeout, attemptExternalId) => {\n    const proctoringBackendWorker = createWorker(workerUrl);\n    return new Promise((resolve, reject) => {\n      const responseHandler = (e) => {\n        if (e.data.type === eventNames.successEventName) {\n          proctoringBackendWorker.removeEventListener('message', responseHandler);\n          proctoringBackendWorker.terminate();\n          resolve();\n        } else {\n          reject(e.data.error);\n        }\n      };\n      proctoringBackendWorker.addEventListener('message', responseHandler);\n      proctoringBackendWorker.postMessage({ type: eventNames.promptEventName, timeout, attemptExternalId });\n    });\n  };\n}\n\nexport function pingApplication(timeoutInSeconds, attemptExternalId, workerUrl) {\n  const TIMEOUT_BUFFER_SECONDS = 10;\n  const workerPingTimeout = timeoutInSeconds - TIMEOUT_BUFFER_SECONDS; // 10s buffer for worker to respond\n  return Promise.race([\n    workerPromiseForEventNames(actionToMessageTypesMap.ping, workerUrl)(workerPingTimeout * 1000, attemptExternalId),\n    workerTimeoutPromise(timeoutInSeconds * 1000),\n  ]);\n}\n"],"mappings":";;;;;;;AAAA,IAAAA,UAAA,GAAAC,sBAAA,CAAAC,OAAA;AAAkD,SAAAD,uBAAAE,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,gBAAAA,GAAA;AAElD,SAASE,YAAYA,CAACC,GAAG,EAAE;EACzB,IAAMC,IAAI,GAAG,IAAIC,IAAI,CAAC,mBAAAC,MAAA,CAAmBH,GAAG,SAAM,EAAE;IAAEI,IAAI,EAAE;EAAyB,CAAC,CAAC;EACvF,IAAMC,OAAO,GAAGC,MAAM,CAACC,GAAG,CAACC,eAAe,CAACP,IAAI,CAAC;EAChD,OAAO,IAAIQ,MAAM,CAACJ,OAAO,CAAC;AAC5B;AAEA,SAASK,oBAAoBA,CAACC,mBAAmB,EAAE;EACjD,IAAMC,OAAO,qCAAAT,MAAA,CAAqCQ,mBAAmB,QAAK;EAC1E,OAAO,IAAIE,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;IACtCC,UAAU,CAAC,YAAM;MACfD,MAAM,CAACE,KAAK,CAACL,OAAO,CAAC,CAAC;IACxB,CAAC,EAAED,mBAAmB,CAAC;EACzB,CAAC,CAAC;AACJ;AAEO,SAASO,0BAA0BA,CAACC,UAAU,EAAEC,SAAS,EAAE;EAChE,OAAO,UAACC,OAAO,EAAEC,iBAAiB,EAAK;IACrC,IAAMC,uBAAuB,GAAGxB,YAAY,CAACqB,SAAS,CAAC;IACvD,OAAO,IAAIP,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;MACtC,IAAMS,eAAe,GAAG,SAAlBA,eAAeA,CAAIC,CAAC,EAAK;QAC7B,IAAIA,CAAC,CAACC,IAAI,CAACtB,IAAI,KAAKe,UAAU,CAACQ,gBAAgB,EAAE;UAC/CJ,uBAAuB,CAACK,mBAAmB,CAAC,SAAS,EAAEJ,eAAe,CAAC;UACvED,uBAAuB,CAACM,SAAS,EAAE;UACnCf,OAAO,EAAE;QACX,CAAC,MAAM;UACLC,MAAM,CAACU,CAAC,CAACC,IAAI,CAACI,KAAK,CAAC;QACtB;MACF,CAAC;MACDP,uBAAuB,CAACQ,gBAAgB,CAAC,SAAS,EAAEP,eAAe,CAAC;MACpED,uBAAuB,CAACS,WAAW,CAAC;QAAE5B,IAAI,EAAEe,UAAU,CAACc,eAAe;QAAEZ,OAAO,EAAPA,OAAO;QAAEC,iBAAiB,EAAjBA;MAAkB,CAAC,CAAC;IACvG,CAAC,CAAC;EACJ,CAAC;AACH;AAEO,SAASY,eAAeA,CAACC,gBAAgB,EAAEb,iBAAiB,EAAEF,SAAS,EAAE;EAC9E,IAAMgB,sBAAsB,GAAG,EAAE;EACjC,IAAMC,iBAAiB,GAAGF,gBAAgB,GAAGC,sBAAsB,CAAC,CAAC;EACrE,OAAOvB,OAAO,CAACyB,IAAI,CAAC,CAClBpB,0BAA0B,CAACqB,qBAAuB,CAACC,IAAI,EAAEpB,SAAS,CAAC,CAACiB,iBAAiB,GAAG,IAAI,EAAEf,iBAAiB,CAAC,EAChHZ,oBAAoB,CAACyB,gBAAgB,GAAG,IAAI,CAAC,CAC9C,CAAC;AACJ"}