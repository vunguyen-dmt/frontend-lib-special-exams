{"version":3,"file":"index.js","names":["DownloadSoftwareProctoredExamInstructions","intl","skipProctoredExam","state","useContext","ExamStateContext","proctoringSettings","exam","getExamAttemptsData","allowProctoringOptOut","attempt","courseId","course_id","sequenceId","content_id","pollUrl","exam_started_poll_url","examCode","attempt_code","attemptId","attempt_id","downloadUrl","software_download_url","useLegacyAttemptApi","use_legacy_attempt_api","providerName","provider_name","supportEmail","provider_tech_support_email","supportPhone","provider_tech_support_phone","proctoringBackend","exam_proctoring_backend","examHasLtiProvider","instructions","useState","systemCheckStatus","setSystemCheckStatus","downloadClicked","setDownloadClicked","withProviderInstructions","length","launchSoftwareUrl","getConfig","EXAMS_BASE_URL","handleDownloadClick","pollExamAttempt","then","data","status","ExamStatus","READY_TO_START","softwareDownloadAttempt","window","open","handleStartExamClick","providerInstructions","Boolean","formatMessage","messages","softwareLoadedModalTitle","cannotStartModalTitle","softwareLoadedModalBody","cannotStartModalBody","propTypes","intlShape","isRequired","PropTypes","func","injectIntl"],"sources":["../../../../src/instructions/proctored_exam/download-instructions/index.jsx"],"sourcesContent":["import React, { useContext, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { getConfig } from '@edx/frontend-platform';\nimport { FormattedMessage, injectIntl, intlShape } from '@edx/frontend-platform/i18n';\nimport { Container } from '@edx/paragon';\nimport ExamStateContext from '../../../context';\nimport { ExamStatus } from '../../../constants';\nimport WarningModal from '../WarningModal';\nimport { pollExamAttempt, softwareDownloadAttempt } from '../../../data/api';\nimport messages from '../messages';\nimport LtiProviderExamInstructions from './LtiProviderInstructions';\nimport RestProviderInstructions from './RestProviderInstructions';\nimport RPNowInstructions from './RPNowInstructions';\nimport DownloadButtons from './DownloadButtons';\nimport Footer from '../Footer';\nimport SkipProctoredExamButton from '../SkipProctoredExamButton';\n\nconst DownloadSoftwareProctoredExamInstructions = ({ intl, skipProctoredExam }) => {\n  const state = useContext(ExamStateContext);\n  const {\n    proctoringSettings,\n    exam,\n    getExamAttemptsData,\n    allowProctoringOptOut,\n  } = state;\n  const {\n    attempt,\n    course_id: courseId,\n    content_id: sequenceId,\n  } = exam;\n  const {\n    exam_started_poll_url: pollUrl,\n    attempt_code: examCode,\n    attempt_id: attemptId,\n    software_download_url: downloadUrl,\n    use_legacy_attempt_api: useLegacyAttemptApi,\n  } = attempt;\n  const {\n    provider_name: providerName,\n    provider_tech_support_email: supportEmail,\n    provider_tech_support_phone: supportPhone,\n    exam_proctoring_backend: proctoringBackend,\n  } = proctoringSettings;\n  const examHasLtiProvider = !useLegacyAttemptApi;\n  const { instructions } = proctoringBackend || {};\n  const [systemCheckStatus, setSystemCheckStatus] = useState('');\n  const [downloadClicked, setDownloadClicked] = useState(false);\n  const withProviderInstructions = instructions && instructions.length > 0;\n  const launchSoftwareUrl = examHasLtiProvider\n    ? `${getConfig().EXAMS_BASE_URL}/lti/start_proctoring/${attemptId}` : downloadUrl;\n\n  const handleDownloadClick = () => {\n    pollExamAttempt(`${pollUrl}?sourceid=instructions`)\n      .then((data) => {\n        if (data.status === ExamStatus.READY_TO_START) {\n          setSystemCheckStatus('success');\n        } else {\n          softwareDownloadAttempt(attemptId);\n          window.open(launchSoftwareUrl, '_blank');\n        }\n      });\n    setDownloadClicked(true);\n  };\n\n  const handleStartExamClick = () => {\n    pollExamAttempt(`${pollUrl}?sourceid=instructions`)\n      .then((data) => (\n        data.status === ExamStatus.READY_TO_START\n          ? getExamAttemptsData(courseId, sequenceId)\n          : setSystemCheckStatus('failure')\n      ));\n  };\n\n  function providerInstructions() {\n    if (examHasLtiProvider) {\n      return (\n        <LtiProviderExamInstructions\n          providerName={providerName}\n          supportEmail={supportEmail}\n          supportPhone={supportPhone}\n        />\n      );\n    }\n    if (withProviderInstructions) {\n      return (\n        <RestProviderInstructions\n          providerName={providerName}\n          supportEmail={supportEmail}\n          supportPhone={supportPhone}\n          instructions={instructions}\n        />\n      );\n    }\n    return (\n      <RPNowInstructions code={examCode} />\n    );\n  }\n\n  return (\n    <div>\n      <Container className=\"border py-5 mb-4\">\n        <WarningModal\n          isOpen={Boolean(systemCheckStatus)}\n          title={\n            systemCheckStatus === 'success'\n              ? intl.formatMessage(messages.softwareLoadedModalTitle)\n              : intl.formatMessage(messages.cannotStartModalTitle)\n          }\n          body={\n            systemCheckStatus === 'success'\n              ? intl.formatMessage(messages.softwareLoadedModalBody)\n              : intl.formatMessage(messages.cannotStartModalBody)\n          }\n          handleClose={() => setSystemCheckStatus('')}\n        />\n        <div className=\"h3\" data-testid=\"exam-instructions-title\">\n          <FormattedMessage\n            id=\"exam.DownloadSoftwareProctoredExamInstructions.title\"\n            defaultMessage=\"Set up and start your proctored exam.\"\n          />\n        </div>\n        { providerInstructions() }\n        <DownloadButtons\n          downloadUrl={launchSoftwareUrl}\n          onDownloadClick={handleDownloadClick}\n          onStartExamClick={handleStartExamClick}\n          downloadClicked={downloadClicked}\n        />\n        {!examHasLtiProvider && !withProviderInstructions && (\n          <div className=\"pt-3\">\n            <div className=\"h4\">\n              <FormattedMessage\n                id=\"exam.DefaultDownloadSoftwareProctoredExamInstructions.step3.title\"\n                defaultMessage=\"Step 3.\"\n              />\n            </div>\n            <p>\n              <FormattedMessage\n                id=\"exam.DefaultDownloadSoftwareProctoredExamInstructions.step3.body\"\n                defaultMessage={'For security and exam integrity reasons, '\n                + 'we ask you to sign in to your edX account. Then we will '\n                + 'direct you to the RPNow proctoring experience.'}\n              />\n            </p>\n          </div>\n        )}\n      </Container>\n      {allowProctoringOptOut && <SkipProctoredExamButton handleClick={skipProctoredExam} />}\n      <Footer />\n    </div>\n  );\n};\n\nDownloadSoftwareProctoredExamInstructions.propTypes = {\n  intl: intlShape.isRequired,\n  skipProctoredExam: PropTypes.func.isRequired,\n};\n\nexport default injectIntl(DownloadSoftwareProctoredExamInstructions);\n"],"mappings":"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"}